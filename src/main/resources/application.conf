ktor {
    deployment {
        # Use environment variable PORT if available, otherwise default to 8080
        port = ${?PORT}
        port = 8080

        host = "0.0.0.0"

        # Auto-reload on changes (development only)
        watch = [ classes, resources ]

        # Add SSL configuration if needed
        # sslPort = ${?SSL_PORT}
        # sslPort = 8443
    }

    application {
        modules = [ com.todoapp.ApplicationKt.module ]
    }

    # Development mode (auto-reload, detailed errors)
    development = ${?DEVELOPMENT}
    development = true

    # Logging configuration
    log {
        # Log level: TRACE, DEBUG, INFO, WARN, ERROR
        level = ${?LOG_LEVEL}
        level = "INFO"
    }

    # Security headers (these work with DefaultHeaders plugin)
    security {
        ssl = false

        # HSTS - HTTPS Strict Transport Security
        hsts {
            max-age-in-seconds = 31536000
            include-sub-domains = true
            preload = true
        }

        # Referrer Policy
        referrer-policy {
            policy = "strict-origin-when-cross-origin"
        }

        # Content Type Options
        content-type-options {
            nosniff = true
        }

        # Frame Options
        frame-options {
            same-origin = true
        }

        # XSS Protection
        xss-protection {
            enabled = true
            mode = "block"
        }

        # CSP - Content Security Policy (optional but recommended)
        # csp {
        #     mode = "report-only"
        #     report-uri = "/csp-violation"
        #     directives {
        #         default-src = "'self'"
        #         script-src = "'self' 'unsafe-inline'"
        #         style-src = "'self' 'unsafe-inline'"
        #     }
        # }
    }

    # Database configuration (optional - if you want to configure in .conf file)
    database {
        url = ${?DB_URL}
        url = "jdbc:postgresql://localhost:5432/todoapp"

        driver = ${?DB_DRIVER}
        driver = "org.postgresql.Driver"

        user = ${?DB_USER}
        user = "postgres"

        password = ${?DB_PASSWORD}
        password = "password"

        maxPoolSize = ${?DB_MAX_POOL_SIZE}
        maxPoolSize = 10
    }

    # JWT configuration (optional)
    jwt {
        secret = ${?JWT_SECRET}
        secret = "your-super-secret-jwt-key-change-in-production"

        issuer = ${?JWT_ISSUER}
        issuer = "todo-app"

        audience = ${?JWT_AUDIENCE}
        audience = "todo-app-users"

        realm = ${?JWT_REALM}
        realm = "todo-app"
    }
}